# Admin Panel - Complete API Documentation
## Categories & Products Management with Soft Delete and Image Management

**Version:** 1.0.0
**Last Updated:** January 15, 2025
**Status:** Production Ready
**Backend Base URL:** `http://your-api-domain.com/api`

---

## üìã Table of Contents

1. [Overview](#overview)
2. [Authentication](#authentication)
3. [Important Notes](#important-notes)
4. [Category Management APIs](#category-management-apis)
5. [Product Management APIs](#product-management-apis)
6. [Admin Workflow Guide](#admin-workflow-guide)
7. [Error Handling](#error-handling)
8. [Frontend Implementation Guide](#frontend-implementation-guide)

---

## Overview

This documentation covers all Admin Panel APIs for managing **Categories** and **Products** with the following features:

### ‚úÖ New Features Implemented

1. **Soft Delete System**
   - Categories and Products are NOT permanently deleted
   - Deleted items can be restored by admin
   - Deleted items are hidden from public/customer APIs
   - Admin can view deleted items separately

2. **Individual Image Management**
   - Delete specific images from categories/products/variants
   - Automatic S3 cleanup when image is deleted
   - Auto re-indexing of remaining images (1-based indexing)

3. **Image Reordering**
   - Reorder images by changing their order
   - 1-based indexing (starts from 1, not 0)
   - Images automatically sorted by order field

4. **Multiple Images Support for Categories**
   - Categories now support multiple images array
   - Old single `image` field still maintained for backward compatibility

5. **Auto-Generated IDs**
   - **Product IDs** are auto-generated by backend
   - **Variant IDs** are auto-generated by backend
   - **Category IDs** are auto-generated by backend
   - **Admin should NEVER manually create IDs**

---

## Authentication

### Required Headers for ALL Admin APIs

```http
Authorization: Bearer <admin-jwt-token>
Content-Type: application/json
```

### Authentication Flow

1. Admin logs in via `/api/auth/admin/login`
2. Backend returns JWT token
3. Frontend stores token (localStorage/sessionStorage)
4. Include token in `Authorization` header for all admin requests

**Example:**
```javascript
const token = localStorage.getItem('adminToken');

fetch('/api/categories', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify(categoryData)
})
```

---

## Important Notes

### üî¥ Critical Information for Frontend Team

1. **DO NOT Send IDs in Create Requests**
   - ‚ùå Do NOT send `productId`, `variantId`, `categoryId` when creating
   - ‚úÖ Backend auto-generates these IDs
   - ‚úÖ Backend returns the generated ID in response

2. **Image Indexing is 1-Based**
   - First image = index 1 (not 0)
   - Second image = index 2
   - When deleting image at index 2, remaining images auto re-index to 1, 2, 3...

3. **Soft Delete Behavior**
   - Public APIs (`GET /api/categories`, `GET /api/products`) hide deleted items automatically
   - Admin APIs show deleted items only when `showDeleted=true` is passed
   - Admin must use restore endpoint to make deleted items visible again

4. **Admin-Only Endpoints**
   - All create/update/delete operations require admin authentication
   - Use `verifyToken` and `isAdmin` middleware
   - Returns 403 if non-admin user tries to access

---

## Category Management APIs

### 1. Get All Categories (Public)

**Endpoint:** `GET /api/categories`

**Description:** Fetches all active categories (excludes soft-deleted)

**Auth Required:** No

**Query Parameters:**
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `parentCategoryId` | String | No | Filter by parent category |
| `isActive` | Boolean | No | Filter by active status |

**Response:**
```json
{
  "success": true,
  "count": 10,
  "data": [
    {
      "_id": "6789abc123def456",
      "categoryId": "CAT-2025-001",
      "name": "Electronics",
      "description": "Electronic items",
      "slug": "electronics",
      "image": {
        "url": "https://s3.amazonaws.com/bucket/old-image.jpg",
        "altText": "Electronics category"
      },
      "images": [
        {
          "url": "https://s3.amazonaws.com/bucket/image1.jpg",
          "altText": "Image 1",
          "order": 1
        },
        {
          "url": "https://s3.amazonaws.com/bucket/image2.jpg",
          "altText": "Image 2",
          "order": 2
        }
      ],
      "banner": {
        "url": "https://s3.amazonaws.com/bucket/banner.jpg",
        "altText": "Banner",
        "link": "/categories/electronics"
      },
      "icon": "electronics-icon.svg",
      "parentCategoryId": null,
      "subCategories": [],
      "level": 0,
      "productCount": 45,
      "isActive": true,
      "isFeatured": true,
      "showInMenu": true,
      "displayOrder": 1,
      "isDeleted": false,
      "createdAt": "2025-01-10T10:00:00.000Z",
      "updatedAt": "2025-01-15T10:00:00.000Z"
    }
  ]
}
```

---

### 2. Get All Categories for Admin (With Deleted)

**Endpoint:** `GET /api/categories/admin/all`

**Description:** Admin-only endpoint to view all categories including deleted ones

**Auth Required:** ‚úÖ Yes (Admin only)

**Query Parameters:**
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `showDeleted` | String | No | Set to `"true"` to include deleted categories |
| `parentCategoryId` | String | No | Filter by parent category |
| `isActive` | Boolean | No | Filter by active status |

**Request Example:**
```http
GET /api/categories/admin/all?showDeleted=true
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**Response:**
```json
{
  "success": true,
  "count": 12,
  "data": [
    {
      "_id": "6789abc123def456",
      "categoryId": "CAT-2025-001",
      "name": "Electronics",
      "isDeleted": false,
      "deletedAt": null,
      "deletedBy": null,
      "...": "other fields"
    },
    {
      "_id": "6789abc123def789",
      "categoryId": "CAT-2025-002",
      "name": "Old Category",
      "isDeleted": true,
      "deletedAt": "2025-01-14T15:30:00.000Z",
      "deletedBy": {
        "_id": "admin123",
        "name": "John Admin",
        "email": "admin@example.com"
      },
      "...": "other fields"
    }
  ]
}
```

**Frontend Implementation:**
```javascript
// Show deleted categories in admin panel
const fetchCategoriesForAdmin = async (includeDeleted = false) => {
  const url = includeDeleted
    ? '/api/categories/admin/all?showDeleted=true'
    : '/api/categories/admin/all';

  const response = await fetch(url, {
    headers: {
      'Authorization': `Bearer ${adminToken}`
    }
  });

  const data = await response.json();
  return data;
};
```

---

### 3. Create Category

**Endpoint:** `POST /api/categories`

**Description:** Create a new category

**Auth Required:** ‚úÖ Yes (Admin only)

**Request Body:**
```json
{
  "name": "Mobile Phones",
  "description": "All types of mobile phones",
  "slug": "mobile-phones",
  "parentCategoryId": "6789abc123def456",
  "icon": "phone-icon.svg",
  "isActive": true,
  "isFeatured": false,
  "showInMenu": true,
  "displayOrder": 5,
  "meta": {
    "title": "Mobile Phones - Best Deals",
    "description": "Buy latest mobile phones",
    "keywords": ["mobile", "phone", "smartphone"]
  }
}
```

**‚ö†Ô∏è IMPORTANT: DO NOT SEND `categoryId`**
- Backend auto-generates `categoryId`
- Format: `CAT-YYYY-XXX` (e.g., `CAT-2025-001`)

**Response:**
```json
{
  "success": true,
  "message": "Category created successfully",
  "data": {
    "_id": "6789abc123def999",
    "categoryId": "CAT-2025-015",
    "name": "Mobile Phones",
    "slug": "mobile-phones",
    "level": 1,
    "path": ["6789abc123def456"],
    "isDeleted": false,
    "...": "other fields"
  }
}
```

**Frontend Implementation:**
```javascript
const createCategory = async (formData) => {
  // DO NOT include categoryId in formData
  const response = await fetch('/api/categories', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${adminToken}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      name: formData.name,
      description: formData.description,
      // ... other fields
      // categoryId: "..." ‚ùå WRONG - Don't send this
    })
  });

  const result = await response.json();
  // Backend returns auto-generated categoryId
  console.log(result.data.categoryId); // "CAT-2025-015"
};
```

---

### 4. Update Category

**Endpoint:** `PUT /api/categories/:categoryId`

**Description:** Update existing category

**Auth Required:** ‚úÖ Yes (Admin only)

**Request Body:**
```json
{
  "name": "Mobile Phones & Tablets",
  "description": "Updated description",
  "isActive": true,
  "isFeatured": true
}
```

**Response:**
```json
{
  "success": true,
  "message": "Category updated successfully",
  "data": {
    "_id": "6789abc123def999",
    "categoryId": "CAT-2025-015",
    "name": "Mobile Phones & Tablets",
    "updatedAt": "2025-01-15T12:00:00.000Z"
  }
}
```

---

### 5. Delete Category (Soft Delete)

**Endpoint:** `DELETE /api/categories/:categoryId`

**Description:** Soft delete a category (not permanently removed)

**Auth Required:** ‚úÖ Yes (Admin only)

**Query Parameters:**
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `force` | Boolean | No | Set to `true` to delete category with subcategories |

**Request Example:**
```http
DELETE /api/categories/CAT-2025-015
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**With subcategories:**
```http
DELETE /api/categories/CAT-2025-015?force=true
```

**Response:**
```json
{
  "success": true,
  "message": "Category deleted successfully"
}
```

**What Happens:**
- Category is marked as `isDeleted: true`
- `deletedAt` is set to current timestamp
- `deletedBy` is set to admin user ID
- Category is hidden from public APIs
- Admin can still view it with `showDeleted=true`
- Category can be restored later

**Frontend Implementation:**
```javascript
const deleteCategory = async (categoryId, forceDelete = false) => {
  const url = forceDelete
    ? `/api/categories/${categoryId}?force=true`
    : `/api/categories/${categoryId}`;

  const response = await fetch(url, {
    method: 'DELETE',
    headers: {
      'Authorization': `Bearer ${adminToken}`
    }
  });

  if (response.ok) {
    // Show success message
    // Refresh category list
    // Mark category as deleted in UI (show "Deleted" badge)
  }
};
```

---

### 6. Restore Deleted Category

**Endpoint:** `PUT /api/categories/:categoryId/restore`

**Description:** Restore a soft-deleted category

**Auth Required:** ‚úÖ Yes (Admin only)

**Request Example:**
```http
PUT /api/categories/CAT-2025-015/restore
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**Response:**
```json
{
  "success": true,
  "message": "Category restored successfully",
  "data": {
    "_id": "6789abc123def999",
    "categoryId": "CAT-2025-015",
    "name": "Mobile Phones",
    "isDeleted": false,
    "deletedAt": null,
    "deletedBy": null
  }
}
```

**Frontend Implementation:**
```javascript
const restoreCategory = async (categoryId) => {
  const response = await fetch(`/api/categories/${categoryId}/restore`, {
    method: 'PUT',
    headers: {
      'Authorization': `Bearer ${adminToken}`
    }
  });

  if (response.ok) {
    // Show success message
    // Category is now visible in public APIs
    // Remove "Deleted" badge from UI
  }
};
```

---

### 7. Delete Individual Image from Category

**Endpoint:** `DELETE /api/categories/:categoryId/images/:imageIndex`

**Description:** Delete a specific image from category's images array

**Auth Required:** ‚úÖ Yes (Admin only)

**Important Notes:**
- Image indexing is **1-based** (first image = 1, not 0)
- Deletes image from S3 automatically
- Remaining images are auto re-indexed

**Request Example:**
```http
DELETE /api/categories/CAT-2025-015/images/2
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**Scenario:**
```
Before: [image1:order=1, image2:order=2, image3:order=3, image4:order=4]
Delete index 2
After:  [image1:order=1, image3:order=2, image4:order=3]
```

**Response:**
```json
{
  "success": true,
  "message": "Image deleted successfully",
  "data": {
    "_id": "6789abc123def999",
    "categoryId": "CAT-2025-015",
    "images": [
      {
        "url": "https://s3.amazonaws.com/bucket/image1.jpg",
        "altText": "Image 1",
        "order": 1
      },
      {
        "url": "https://s3.amazonaws.com/bucket/image3.jpg",
        "altText": "Image 3",
        "order": 2
      },
      {
        "url": "https://s3.amazonaws.com/bucket/image4.jpg",
        "altText": "Image 4",
        "order": 3
      }
    ]
  }
}
```

**Frontend Implementation:**
```javascript
const deleteCategoryImage = async (categoryId, imageIndex) => {
  // imageIndex is 1-based (first image = 1)
  const response = await fetch(
    `/api/categories/${categoryId}/images/${imageIndex}`,
    {
      method: 'DELETE',
      headers: {
        'Authorization': `Bearer ${adminToken}`
      }
    }
  );

  if (response.ok) {
    // Image deleted from S3
    // Remaining images re-indexed
    // Refresh category data to show updated images
  }
};

// Example: Delete second image
deleteCategoryImage('CAT-2025-015', 2);
```

---

### 8. Reorder Category Images

**Endpoint:** `PUT /api/categories/:categoryId/images/reorder`

**Description:** Change the order of images in category

**Auth Required:** ‚úÖ Yes (Admin only)

**Request Body:**
```json
{
  "imageOrders": [
    { "index": 1, "order": 3 },
    { "index": 2, "order": 1 },
    { "index": 3, "order": 2 }
  ]
}
```

**Explanation:**
- `index`: Current position of image (1-based)
- `order`: New order you want to assign

**Example Scenario:**
```
Current: [imageA:order=1, imageB:order=2, imageC:order=3]

Request:
{
  "imageOrders": [
    { "index": 1, "order": 3 },  // Move imageA to position 3
    { "index": 2, "order": 1 },  // Move imageB to position 1
    { "index": 3, "order": 2 }   // Move imageC to position 2
  ]
}

Result: [imageB:order=1, imageC:order=2, imageA:order=3]
```

**Response:**
```json
{
  "success": true,
  "message": "Images reordered successfully",
  "data": {
    "images": [
      {
        "url": "https://s3.amazonaws.com/bucket/imageB.jpg",
        "order": 1
      },
      {
        "url": "https://s3.amazonaws.com/bucket/imageC.jpg",
        "order": 2
      },
      {
        "url": "https://s3.amazonaws.com/bucket/imageA.jpg",
        "order": 3
      }
    ]
  }
}
```

**Frontend Implementation:**
```javascript
const reorderCategoryImages = async (categoryId, newOrder) => {
  // newOrder = [{ index: 1, order: 3 }, { index: 2, order: 1 }, ...]

  const response = await fetch(
    `/api/categories/${categoryId}/images/reorder`,
    {
      method: 'PUT',
      headers: {
        'Authorization': `Bearer ${adminToken}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        imageOrders: newOrder
      })
    }
  );

  if (response.ok) {
    // Images reordered
    // Update UI to reflect new order
  }
};

// Drag-and-drop example
const handleImageDragEnd = (result) => {
  const { source, destination } = result;

  const newOrder = images.map((img, idx) => ({
    index: idx + 1,  // 1-based index
    order: idx === source.index ? destination.index + 1 :
           idx === destination.index ? source.index + 1 :
           idx + 1
  }));

  reorderCategoryImages(categoryId, newOrder);
};
```

---

## Product Management APIs

### 1. Get All Products (Public)

**Endpoint:** `GET /api/products`

**Description:** Fetches all active products (excludes soft-deleted)

**Auth Required:** No

**Query Parameters:**
| Parameter | Type | Description |
|-----------|------|-------------|
| `page` | Number | Page number (default: 1) |
| `limit` | Number | Items per page (default: 10) |
| `search` | String | Search by name/description |
| `category` | String | Filter by category |
| `brand` | String | Filter by brand |
| `minPrice` | Number | Minimum price |
| `maxPrice` | Number | Maximum price |
| `status` | String | Filter by status (draft, published, active) |
| `region` | String | Filter by region |
| `hasVariants` | Boolean | Filter products with variants |
| `simpleOnly` | Boolean | Filter simple products only |

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "_id": "prod123abc",
      "productId": "PROD-2025-001",
      "variantId": null,
      "name": "iPhone 15 Pro",
      "description": {
        "short": "Latest iPhone model",
        "long": "Detailed description...",
        "features": ["A17 Pro chip", "48MP camera"],
        "specifications": {}
      },
      "category": {
        "mainCategoryId": "cat123",
        "mainCategoryName": "Electronics",
        "subCategoryId": "subcat456",
        "subCategoryName": "Mobile Phones"
      },
      "brand": "Apple",
      "sku": "SKU-IPHONE-15-PRO",
      "pricing": {
        "regularPrice": 999,
        "salePrice": 899,
        "finalPrice": 899,
        "currency": "USD"
      },
      "images": [
        {
          "url": "https://s3.amazonaws.com/bucket/iphone1.jpg",
          "isPrimary": true,
          "altText": "iPhone front view",
          "order": 1
        },
        {
          "url": "https://s3.amazonaws.com/bucket/iphone2.jpg",
          "isPrimary": false,
          "altText": "iPhone back view",
          "order": 2
        }
      ],
      "variants": [],
      "hasVariants": false,
      "status": "published",
      "isPopular": true,
      "isBestSeller": false,
      "isTrending": true,
      "isDeleted": false,
      "createdAt": "2025-01-10T10:00:00.000Z",
      "updatedAt": "2025-01-15T10:00:00.000Z"
    }
  ],
  "pagination": {
    "current": 1,
    "pages": 5,
    "total": 50
  }
}
```

---

### 2. Get All Products for Admin (With Deleted)

**Endpoint:** `GET /api/products/admin/all`

**Description:** Admin-only endpoint to view all products including deleted ones

**Auth Required:** ‚úÖ Yes (Admin only)

**Query Parameters:**
| Parameter | Type | Description |
|-----------|------|-------------|
| `showDeleted` | String | Set to `"true"` to include deleted products |
| `page` | Number | Page number |
| `limit` | Number | Items per page |
| All other filters from public API | | |

**Request Example:**
```http
GET /api/products/admin/all?showDeleted=true&page=1&limit=20
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "productId": "PROD-2025-001",
      "name": "iPhone 15 Pro",
      "isDeleted": false,
      "deletedAt": null,
      "deletedBy": null,
      "...": "other fields"
    },
    {
      "productId": "PROD-2025-002",
      "name": "Old Product",
      "isDeleted": true,
      "deletedAt": "2025-01-14T15:30:00.000Z",
      "deletedBy": {
        "_id": "admin123",
        "name": "John Admin",
        "email": "admin@example.com"
      },
      "...": "other fields"
    }
  ],
  "pagination": {
    "current": 1,
    "pages": 3,
    "total": 60
  }
}
```

---

### 3. Create Product

**Endpoint:** `POST /api/products`

**Description:** Create a new product

**Auth Required:** ‚úÖ Yes (Admin only)

**Request Body:**
```json
{
  "name": "Samsung Galaxy S24",
  "description": {
    "short": "Latest Samsung flagship phone",
    "long": "Detailed description of the phone...",
    "features": ["Snapdragon 8 Gen 3", "200MP camera"],
    "specifications": {
      "display": "6.8 inch AMOLED",
      "battery": "5000mAh"
    }
  },
  "category": {
    "mainCategoryId": "cat123",
    "mainCategoryName": "Electronics",
    "subCategoryId": "subcat456",
    "subCategoryName": "Mobile Phones"
  },
  "brand": "Samsung",
  "sku": "SKU-SAMSUNG-S24",
  "pricing": {
    "regularPrice": 899,
    "salePrice": 799,
    "finalPrice": 799,
    "currency": "USD"
  },
  "availability": {
    "isAvailable": true,
    "stockQuantity": 50,
    "lowStockLevel": 10,
    "stockStatus": "in_stock"
  },
  "status": "published",
  "isPopular": false,
  "isBestSeller": false,
  "isTrending": false
}
```

**‚ö†Ô∏è CRITICAL: DO NOT SEND THESE FIELDS:**
- ‚ùå `productId` - Backend auto-generates (format: `PROD-YYYY-XXX`)
- ‚ùå `variantId` - Only for variant products, backend auto-generates
- ‚ùå Any ID fields - All IDs are backend-generated

**Response:**
```json
{
  "success": true,
  "message": "Product created successfully",
  "data": {
    "_id": "prod789xyz",
    "productId": "PROD-2025-025",
    "name": "Samsung Galaxy S24",
    "sku": "SKU-SAMSUNG-S24",
    "status": "published",
    "isDeleted": false,
    "createdAt": "2025-01-15T12:00:00.000Z",
    "...": "other fields"
  }
}
```

**Frontend Implementation:**
```javascript
const createProduct = async (productFormData) => {
  // DO NOT include productId or variantId
  const response = await fetch('/api/products', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${adminToken}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      name: productFormData.name,
      description: productFormData.description,
      category: productFormData.category,
      brand: productFormData.brand,
      pricing: productFormData.pricing,
      // productId: "..." ‚ùå WRONG - Don't send this
      // variantId: "..." ‚ùå WRONG - Don't send this
    })
  });

  const result = await response.json();
  // Backend returns auto-generated productId
  console.log(result.data.productId); // "PROD-2025-025"

  return result;
};
```

---

### 4. Create Product with Variants

**Endpoint:** `POST /api/products`

**Description:** Create a product with multiple variants

**Auth Required:** ‚úÖ Yes (Admin only)

**Request Body:**
```json
{
  "name": "Samsung Galaxy S24",
  "hasVariants": true,
  "variants": [
    {
      "sku": "SKU-S24-BLACK-128",
      "attributes": {
        "color": "Black",
        "storage": "128GB"
      },
      "description": {
        "short": "Black color, 128GB storage"
      },
      "price": 799,
      "salePrice": 749,
      "stock": 30,
      "isActive": true
    },
    {
      "sku": "SKU-S24-WHITE-256",
      "attributes": {
        "color": "White",
        "storage": "256GB"
      },
      "description": {
        "short": "White color, 256GB storage"
      },
      "price": 899,
      "salePrice": 849,
      "stock": 20,
      "isActive": true
    }
  ],
  "...": "other product fields"
}
```

**‚ö†Ô∏è IMPORTANT: DO NOT SEND `variantId` for Each Variant**
- Backend auto-generates `variantId` for each variant
- Format: `VAR-YYYY-XXX`

**Response:**
```json
{
  "success": true,
  "message": "Product with variants created successfully",
  "data": {
    "productId": "PROD-2025-026",
    "name": "Samsung Galaxy S24",
    "hasVariants": true,
    "variants": [
      {
        "variantId": "VAR-2025-001",
        "sku": "SKU-S24-BLACK-128",
        "attributes": {
          "color": "Black",
          "storage": "128GB"
        },
        "price": 799,
        "...": "other fields"
      },
      {
        "variantId": "VAR-2025-002",
        "sku": "SKU-S24-WHITE-256",
        "attributes": {
          "color": "White",
          "storage": "256GB"
        },
        "price": 899,
        "...": "other fields"
      }
    ]
  }
}
```

---

### 5. Update Product

**Endpoint:** `PUT /api/products/:productId`

**Description:** Update existing product

**Auth Required:** ‚úÖ Yes (Admin only)

**Request Body:**
```json
{
  "name": "Samsung Galaxy S24 Ultra",
  "pricing": {
    "regularPrice": 1199,
    "salePrice": 1099
  },
  "status": "published"
}
```

**Response:**
```json
{
  "success": true,
  "message": "Product updated successfully",
  "data": {
    "productId": "PROD-2025-026",
    "name": "Samsung Galaxy S24 Ultra",
    "updatedAt": "2025-01-15T14:00:00.000Z"
  }
}
```

---

### 6. Delete Product (Soft Delete)

**Endpoint:** `DELETE /api/products/:productId`

**Description:** Soft delete a product (not permanently removed)

**Auth Required:** ‚úÖ Yes (Admin only)

**Request Example:**
```http
DELETE /api/products/PROD-2025-026
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**Response:**
```json
{
  "success": true,
  "message": "Product deleted successfully"
}
```

**What Happens:**
- Product is marked as `isDeleted: true`
- `deletedAt` is set to current timestamp
- `deletedBy` is set to admin user ID
- Product is hidden from public APIs
- All variants (if any) remain with the product
- Admin can still view it with `showDeleted=true`
- Product can be restored later

---

### 7. Restore Deleted Product

**Endpoint:** `PUT /api/products/:productId/restore`

**Description:** Restore a soft-deleted product

**Auth Required:** ‚úÖ Yes (Admin only)

**Request Example:**
```http
PUT /api/products/PROD-2025-026/restore
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**Response:**
```json
{
  "success": true,
  "message": "Product restored successfully",
  "data": {
    "productId": "PROD-2025-026",
    "name": "Samsung Galaxy S24 Ultra",
    "isDeleted": false,
    "deletedAt": null,
    "deletedBy": null
  }
}
```

---

### 8. Delete Individual Image from Product

**Endpoint:** `DELETE /api/products/:productId/images/:imageIndex`

**Description:** Delete a specific image from product's images array

**Auth Required:** ‚úÖ Yes (Admin only)

**Important Notes:**
- Image indexing is **1-based** (first image = 1)
- Deletes image from S3 automatically
- Remaining images are auto re-indexed

**Request Example:**
```http
DELETE /api/products/PROD-2025-026/images/3
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**Scenario:**
```
Before: [img1:order=1, img2:order=2, img3:order=3, img4:order=4, img5:order=5]
Delete index 3
After:  [img1:order=1, img2:order=2, img4:order=3, img5:order=4]
```

**Response:**
```json
{
  "success": true,
  "message": "Image deleted successfully",
  "data": {
    "productId": "PROD-2025-026",
    "images": [
      {
        "url": "https://s3.amazonaws.com/bucket/img1.jpg",
        "order": 1,
        "isPrimary": true
      },
      {
        "url": "https://s3.amazonaws.com/bucket/img2.jpg",
        "order": 2,
        "isPrimary": false
      },
      {
        "url": "https://s3.amazonaws.com/bucket/img4.jpg",
        "order": 3,
        "isPrimary": false
      },
      {
        "url": "https://s3.amazonaws.com/bucket/img5.jpg",
        "order": 4,
        "isPrimary": false
      }
    ]
  }
}
```

---

### 9. Delete Individual Image from Variant

**Endpoint:** `DELETE /api/products/:productId/variants/:variantId/images/:imageIndex`

**Description:** Delete a specific image from variant's images array

**Auth Required:** ‚úÖ Yes (Admin only)

**Request Example:**
```http
DELETE /api/products/PROD-2025-026/variants/VAR-2025-001/images/2
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**Response:**
```json
{
  "success": true,
  "message": "Variant image deleted successfully",
  "data": {
    "productId": "PROD-2025-026",
    "variants": [
      {
        "variantId": "VAR-2025-001",
        "images": [
          {
            "url": "https://s3.amazonaws.com/bucket/var-img1.jpg",
            "order": 1
          },
          {
            "url": "https://s3.amazonaws.com/bucket/var-img3.jpg",
            "order": 2
          }
        ]
      }
    ]
  }
}
```

---

### 10. Reorder Product Images

**Endpoint:** `PUT /api/products/:productId/images/reorder`

**Description:** Change the order of images in product

**Auth Required:** ‚úÖ Yes (Admin only)

**Request Body:**
```json
{
  "imageOrders": [
    { "index": 1, "order": 4 },
    { "index": 2, "order": 1 },
    { "index": 3, "order": 3 },
    { "index": 4, "order": 2 }
  ]
}
```

**Response:**
```json
{
  "success": true,
  "message": "Images reordered successfully",
  "data": {
    "images": [
      {
        "url": "https://s3.amazonaws.com/bucket/img2.jpg",
        "order": 1
      },
      {
        "url": "https://s3.amazonaws.com/bucket/img4.jpg",
        "order": 2
      },
      {
        "url": "https://s3.amazonaws.com/bucket/img3.jpg",
        "order": 3
      },
      {
        "url": "https://s3.amazonaws.com/bucket/img1.jpg",
        "order": 4
      }
    ]
  }
}
```

---

### 11. Reorder Variant Images

**Endpoint:** `PUT /api/products/:productId/variants/:variantId/images/reorder`

**Description:** Change the order of images in variant

**Auth Required:** ‚úÖ Yes (Admin only)

**Request Body:**
```json
{
  "imageOrders": [
    { "index": 1, "order": 2 },
    { "index": 2, "order": 1 }
  ]
}
```

**Response:**
```json
{
  "success": true,
  "message": "Variant images reordered successfully",
  "data": {
    "productId": "PROD-2025-026",
    "variants": [
      {
        "variantId": "VAR-2025-001",
        "images": [
          {
            "url": "https://s3.amazonaws.com/bucket/var-img2.jpg",
            "order": 1
          },
          {
            "url": "https://s3.amazonaws.com/bucket/var-img1.jpg",
            "order": 2
          }
        ]
      }
    ]
  }
}
```

---

## Admin Workflow Guide

### Category Management Workflow

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 CATEGORY MANAGEMENT FLOW                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

1. VIEW CATEGORIES
   ‚îú‚îÄ Public users ‚Üí GET /api/categories (only active)
   ‚îî‚îÄ Admin ‚Üí GET /api/categories/admin/all?showDeleted=true

2. CREATE CATEGORY
   ‚îú‚îÄ Admin fills form (name, description, etc.)
   ‚îú‚îÄ ‚ùå Do NOT send categoryId
   ‚îú‚îÄ POST /api/categories
   ‚îî‚îÄ Backend returns auto-generated categoryId

3. UPLOAD CATEGORY IMAGES
   ‚îú‚îÄ After category created
   ‚îú‚îÄ Upload multiple images
   ‚îî‚îÄ Images stored in 'images' array with order field

4. MANAGE CATEGORY IMAGES
   ‚îú‚îÄ Delete image ‚Üí DELETE /api/categories/:id/images/:index
   ‚îú‚îÄ Reorder images ‚Üí PUT /api/categories/:id/images/reorder
   ‚îî‚îÄ Images auto re-indexed after deletion

5. UPDATE CATEGORY
   ‚îî‚îÄ PUT /api/categories/:categoryId

6. DELETE CATEGORY
   ‚îú‚îÄ DELETE /api/categories/:categoryId (soft delete)
   ‚îú‚îÄ Category hidden from public
   ‚îú‚îÄ Admin can still see with showDeleted=true
   ‚îî‚îÄ Category can be restored

7. RESTORE CATEGORY
   ‚îú‚îÄ PUT /api/categories/:categoryId/restore
   ‚îî‚îÄ Category visible again in public APIs
```

---

### Product Management Workflow

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 PRODUCT MANAGEMENT FLOW                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

1. VIEW PRODUCTS
   ‚îú‚îÄ Public users ‚Üí GET /api/products (only active)
   ‚îî‚îÄ Admin ‚Üí GET /api/products/admin/all?showDeleted=true

2. CREATE PRODUCT (Simple)
   ‚îú‚îÄ Admin fills product form
   ‚îú‚îÄ ‚ùå Do NOT send productId
   ‚îú‚îÄ POST /api/products
   ‚îî‚îÄ Backend returns auto-generated productId

3. CREATE PRODUCT (With Variants)
   ‚îú‚îÄ Admin fills product form
   ‚îú‚îÄ Set hasVariants = true
   ‚îú‚îÄ Add variants array
   ‚îú‚îÄ ‚ùå Do NOT send variantId for each variant
   ‚îú‚îÄ POST /api/products
   ‚îî‚îÄ Backend returns productId + variantId for each variant

4. UPLOAD PRODUCT IMAGES
   ‚îú‚îÄ Upload to main product ‚Üí images array
   ‚îú‚îÄ Upload to specific variant ‚Üí variant.images array
   ‚îî‚îÄ Each image gets auto-assigned order field

5. MANAGE PRODUCT IMAGES
   ‚îú‚îÄ Delete product image ‚Üí DELETE /api/products/:id/images/:index
   ‚îú‚îÄ Delete variant image ‚Üí DELETE /api/products/:id/variants/:vid/images/:index
   ‚îú‚îÄ Reorder product images ‚Üí PUT /api/products/:id/images/reorder
   ‚îú‚îÄ Reorder variant images ‚Üí PUT /api/products/:id/variants/:vid/images/reorder
   ‚îî‚îÄ Auto re-indexing after deletion

6. UPDATE PRODUCT
   ‚îî‚îÄ PUT /api/products/:productId

7. DELETE PRODUCT
   ‚îú‚îÄ DELETE /api/products/:productId (soft delete)
   ‚îú‚îÄ Product + all variants hidden from public
   ‚îú‚îÄ Admin can still see with showDeleted=true
   ‚îî‚îÄ Product can be restored

8. RESTORE PRODUCT
   ‚îú‚îÄ PUT /api/products/:productId/restore
   ‚îî‚îÄ Product + all variants visible again
```

---

## Error Handling

### Common Error Responses

#### 1. Unauthorized (No Token)
```json
{
  "success": false,
  "message": "Authentication token required",
  "code": "NO_TOKEN"
}
```

**HTTP Status:** 401

**Frontend Action:**
- Redirect to login page
- Clear stored token
- Show "Session expired" message

---

#### 2. Forbidden (Not Admin)
```json
{
  "success": false,
  "message": "Access denied. Admin role required.",
  "code": "ADMIN_REQUIRED"
}
```

**HTTP Status:** 403

**Frontend Action:**
- Show "Access denied" message
- Redirect to user dashboard (not admin panel)

---

#### 3. Invalid Image Index
```json
{
  "success": false,
  "message": "Invalid image index. Index must be a positive number starting from 1"
}
```

**HTTP Status:** 400

**Frontend Action:**
- Show error message
- Validate image index before sending request

---

#### 4. Image Index Out of Range
```json
{
  "success": false,
  "message": "Image index out of range"
}
```

**HTTP Status:** 400

**Frontend Action:**
- Check number of images before allowing deletion
- Show error message

---

#### 5. Already Deleted
```json
{
  "success": false,
  "message": "Category is already deleted"
}
```

**HTTP Status:** 400

**Frontend Action:**
- Disable "Delete" button for deleted items
- Show "Already deleted" status

---

#### 6. Not Deleted (Restore Attempt)
```json
{
  "success": false,
  "message": "Category is not deleted"
}
```

**HTTP Status:** 400

**Frontend Action:**
- Only show "Restore" button for deleted items
- Hide "Restore" for active items

---

#### 7. Category Not Found
```json
{
  "success": false,
  "message": "Category not found"
}
```

**HTTP Status:** 404

**Frontend Action:**
- Show "Item not found" message
- Refresh list
- Remove item from UI

---

#### 8. Product Not Found
```json
{
  "success": false,
  "message": "Product not found"
}
```

**HTTP Status:** 404

---

#### 9. Variant Not Found
```json
{
  "success": false,
  "message": "Variant not found"
}
```

**HTTP Status:** 404

---

#### 10. Server Error
```json
{
  "success": false,
  "message": "Internal server error description"
}
```

**HTTP Status:** 500

**Frontend Action:**
- Show generic error message
- Log error to monitoring service
- Allow user to retry

---

## Frontend Implementation Guide

### 1. Admin Panel Structure

```
admin-panel/
‚îú‚îÄ‚îÄ dashboard/
‚îú‚îÄ‚îÄ categories/
‚îÇ   ‚îú‚îÄ‚îÄ list/           (Show all categories with deleted indicator)
‚îÇ   ‚îú‚îÄ‚îÄ create/         (Form to create new category)
‚îÇ   ‚îú‚îÄ‚îÄ edit/:id        (Update category)
‚îÇ   ‚îî‚îÄ‚îÄ deleted/        (Show only deleted categories)
‚îú‚îÄ‚îÄ products/
‚îÇ   ‚îú‚îÄ‚îÄ list/           (Show all products with deleted indicator)
‚îÇ   ‚îú‚îÄ‚îÄ create/         (Form to create product)
‚îÇ   ‚îú‚îÄ‚îÄ create-variant/ (Form to create product with variants)
‚îÇ   ‚îú‚îÄ‚îÄ edit/:id        (Update product)
‚îÇ   ‚îî‚îÄ‚îÄ deleted/        (Show only deleted products)
‚îî‚îÄ‚îÄ settings/
```

---

### 2. Category List Page

**Features to Implement:**

```javascript
// Category List Component
const CategoryList = () => {
  const [categories, setCategories] = useState([]);
  const [showDeleted, setShowDeleted] = useState(false);
  const adminToken = localStorage.getItem('adminToken');

  // Fetch categories
  const fetchCategories = async () => {
    const url = showDeleted
      ? '/api/categories/admin/all?showDeleted=true'
      : '/api/categories/admin/all';

    const response = await fetch(url, {
      headers: {
        'Authorization': `Bearer ${adminToken}`
      }
    });

    const data = await response.json();
    setCategories(data.data);
  };

  // Delete category
  const handleDelete = async (categoryId) => {
    const confirmed = window.confirm('Delete this category?');
    if (!confirmed) return;

    const response = await fetch(`/api/categories/${categoryId}`, {
      method: 'DELETE',
      headers: {
        'Authorization': `Bearer ${adminToken}`
      }
    });

    if (response.ok) {
      alert('Category deleted successfully');
      fetchCategories(); // Refresh list
    }
  };

  // Restore category
  const handleRestore = async (categoryId) => {
    const response = await fetch(`/api/categories/${categoryId}/restore`, {
      method: 'PUT',
      headers: {
        'Authorization': `Bearer ${adminToken}`
      }
    });

    if (response.ok) {
      alert('Category restored successfully');
      fetchCategories();
    }
  };

  return (
    <div>
      <h1>Category Management</h1>

      {/* Toggle to show/hide deleted */}
      <label>
        <input
          type="checkbox"
          checked={showDeleted}
          onChange={(e) => setShowDeleted(e.target.checked)}
        />
        Show Deleted Categories
      </label>

      {/* Category table */}
      <table>
        <thead>
          <tr>
            <th>Category ID</th>
            <th>Name</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {categories.map(cat => (
            <tr key={cat._id}>
              <td>{cat.categoryId}</td>
              <td>{cat.name}</td>
              <td>
                {cat.isDeleted ? (
                  <span className="badge badge-danger">
                    Deleted on {new Date(cat.deletedAt).toLocaleDateString()}
                  </span>
                ) : (
                  <span className="badge badge-success">Active</span>
                )}
              </td>
              <td>
                {cat.isDeleted ? (
                  <button onClick={() => handleRestore(cat.categoryId)}>
                    Restore
                  </button>
                ) : (
                  <>
                    <button onClick={() => navigate(`/admin/categories/edit/${cat.categoryId}`)}>
                      Edit
                    </button>
                    <button onClick={() => handleDelete(cat.categoryId)}>
                      Delete
                    </button>
                  </>
                )}
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
};
```

---

### 3. Create Category Form

**Important: DO NOT Send categoryId**

```javascript
const CreateCategory = () => {
  const [formData, setFormData] = useState({
    name: '',
    description: '',
    slug: '',
    parentCategoryId: null,
    isActive: true,
    isFeatured: false
  });

  const handleSubmit = async (e) => {
    e.preventDefault();

    const response = await fetch('/api/categories', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${adminToken}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        name: formData.name,
        description: formData.description,
        slug: formData.slug,
        parentCategoryId: formData.parentCategoryId,
        isActive: formData.isActive,
        isFeatured: formData.isFeatured
        // ‚ùå DO NOT SEND: categoryId
      })
    });

    const result = await response.json();

    if (result.success) {
      alert(`Category created! ID: ${result.data.categoryId}`);
      // Backend generated categoryId: "CAT-2025-XXX"
      navigate('/admin/categories');
    } else {
      alert(`Error: ${result.message}`);
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      <input
        type="text"
        placeholder="Category Name"
        value={formData.name}
        onChange={(e) => setFormData({...formData, name: e.target.value})}
        required
      />

      <textarea
        placeholder="Description"
        value={formData.description}
        onChange={(e) => setFormData({...formData, description: e.target.value})}
      />

      <input
        type="text"
        placeholder="Slug (e.g., electronics)"
        value={formData.slug}
        onChange={(e) => setFormData({...formData, slug: e.target.value})}
      />

      <label>
        <input
          type="checkbox"
          checked={formData.isActive}
          onChange={(e) => setFormData({...formData, isActive: e.target.checked})}
        />
        Active
      </label>

      <label>
        <input
          type="checkbox"
          checked={formData.isFeatured}
          onChange={(e) => setFormData({...formData, isFeatured: e.target.checked})}
        />
        Featured
      </label>

      <button type="submit">Create Category</button>
    </form>
  );
};
```

---

### 4. Image Management Component

**For Category/Product Image Gallery**

```javascript
const ImageGallery = ({ images, categoryId, onUpdate }) => {
  const adminToken = localStorage.getItem('adminToken');

  // Delete image by index (1-based)
  const handleDeleteImage = async (imageIndex) => {
    const confirmed = window.confirm(`Delete image at position ${imageIndex}?`);
    if (!confirmed) return;

    const response = await fetch(
      `/api/categories/${categoryId}/images/${imageIndex}`,
      {
        method: 'DELETE',
        headers: {
          'Authorization': `Bearer ${adminToken}`
        }
      }
    );

    if (response.ok) {
      alert('Image deleted successfully');
      onUpdate(); // Refresh category data
    } else {
      const error = await response.json();
      alert(`Error: ${error.message}`);
    }
  };

  // Reorder images using drag-and-drop
  const handleDragEnd = async (result) => {
    if (!result.destination) return;

    const sourceIndex = result.source.index + 1; // Convert to 1-based
    const destIndex = result.destination.index + 1;

    // Create new order array
    const imageOrders = images.map((img, idx) => ({
      index: idx + 1,
      order: idx === result.source.index ? destIndex :
             idx === result.destination.index ? sourceIndex :
             idx + 1
    }));

    const response = await fetch(
      `/api/categories/${categoryId}/images/reorder`,
      {
        method: 'PUT',
        headers: {
          'Authorization': `Bearer ${adminToken}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ imageOrders })
      }
    );

    if (response.ok) {
      onUpdate(); // Refresh category data
    }
  };

  return (
    <div className="image-gallery">
      <h3>Category Images</h3>

      <DragDropContext onDragEnd={handleDragEnd}>
        <Droppable droppableId="images">
          {(provided) => (
            <div {...provided.droppableProps} ref={provided.innerRef}>
              {images.map((image, index) => (
                <Draggable
                  key={index}
                  draggableId={`image-${index}`}
                  index={index}
                >
                  {(provided) => (
                    <div
                      ref={provided.innerRef}
                      {...provided.draggableProps}
                      {...provided.dragHandleProps}
                      className="image-item"
                    >
                      <span className="image-order">#{index + 1}</span>
                      <img src={image.url} alt={image.altText} />
                      <button
                        onClick={() => handleDeleteImage(index + 1)}
                        className="delete-btn"
                      >
                        Delete
                      </button>
                    </div>
                  )}
                </Draggable>
              ))}
              {provided.placeholder}
            </div>
          )}
        </Droppable>
      </DragDropContext>
    </div>
  );
};
```

---

### 5. Create Product Form

**Important: DO NOT Send productId or variantId**

```javascript
const CreateProduct = () => {
  const [formData, setFormData] = useState({
    name: '',
    description: {
      short: '',
      long: '',
      features: []
    },
    category: {
      mainCategoryId: '',
      mainCategoryName: '',
      subCategoryId: '',
      subCategoryName: ''
    },
    brand: '',
    pricing: {
      regularPrice: 0,
      salePrice: 0,
      currency: 'USD'
    },
    hasVariants: false,
    variants: []
  });

  const handleSubmit = async (e) => {
    e.preventDefault();

    const response = await fetch('/api/products', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${adminToken}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        name: formData.name,
        description: formData.description,
        category: formData.category,
        brand: formData.brand,
        pricing: formData.pricing,
        hasVariants: formData.hasVariants,
        variants: formData.variants.map(v => ({
          sku: v.sku,
          attributes: v.attributes,
          price: v.price,
          stock: v.stock
          // ‚ùå DO NOT SEND: variantId
        }))
        // ‚ùå DO NOT SEND: productId
      })
    });

    const result = await response.json();

    if (result.success) {
      alert(`Product created! ID: ${result.data.productId}`);
      // Backend generated productId: "PROD-2025-XXX"
      // Backend generated variantId for each variant: "VAR-2025-XXX"
      navigate('/admin/products');
    } else {
      alert(`Error: ${result.message}`);
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      {/* Product form fields */}
      <input
        type="text"
        placeholder="Product Name"
        value={formData.name}
        onChange={(e) => setFormData({...formData, name: e.target.value})}
        required
      />

      {/* Price fields */}
      <input
        type="number"
        placeholder="Regular Price"
        value={formData.pricing.regularPrice}
        onChange={(e) => setFormData({
          ...formData,
          pricing: {...formData.pricing, regularPrice: parseFloat(e.target.value)}
        })}
      />

      {/* Variant checkbox */}
      <label>
        <input
          type="checkbox"
          checked={formData.hasVariants}
          onChange={(e) => setFormData({...formData, hasVariants: e.target.checked})}
        />
        This product has variants
      </label>

      {/* Variant section (if hasVariants = true) */}
      {formData.hasVariants && (
        <div className="variants-section">
          <h3>Variants</h3>
          {formData.variants.map((variant, idx) => (
            <div key={idx} className="variant-item">
              <input
                type="text"
                placeholder="SKU"
                value={variant.sku}
                onChange={(e) => {
                  const newVariants = [...formData.variants];
                  newVariants[idx].sku = e.target.value;
                  setFormData({...formData, variants: newVariants});
                }}
              />
              {/* More variant fields */}
            </div>
          ))}

          <button type="button" onClick={() => {
            setFormData({
              ...formData,
              variants: [...formData.variants, { sku: '', price: 0, stock: 0 }]
            });
          }}>
            Add Variant
          </button>
        </div>
      )}

      <button type="submit">Create Product</button>
    </form>
  );
};
```

---

### 6. Product List with Deleted Indicator

```javascript
const ProductList = () => {
  const [products, setProducts] = useState([]);
  const [showDeleted, setShowDeleted] = useState(false);
  const [pagination, setPagination] = useState({ current: 1, pages: 1, total: 0 });

  const fetchProducts = async (page = 1) => {
    const url = showDeleted
      ? `/api/products/admin/all?showDeleted=true&page=${page}&limit=20`
      : `/api/products/admin/all?page=${page}&limit=20`;

    const response = await fetch(url, {
      headers: {
        'Authorization': `Bearer ${adminToken}`
      }
    });

    const data = await response.json();
    setProducts(data.data);
    setPagination(data.pagination);
  };

  const handleDelete = async (productId) => {
    const confirmed = window.confirm('Delete this product?');
    if (!confirmed) return;

    const response = await fetch(`/api/products/${productId}`, {
      method: 'DELETE',
      headers: {
        'Authorization': `Bearer ${adminToken}`
      }
    });

    if (response.ok) {
      alert('Product deleted successfully');
      fetchProducts(pagination.current);
    }
  };

  const handleRestore = async (productId) => {
    const response = await fetch(`/api/products/${productId}/restore`, {
      method: 'PUT',
      headers: {
        'Authorization': `Bearer ${adminToken}`
      }
    });

    if (response.ok) {
      alert('Product restored successfully');
      fetchProducts(pagination.current);
    }
  };

  return (
    <div>
      <h1>Product Management</h1>

      <label>
        <input
          type="checkbox"
          checked={showDeleted}
          onChange={(e) => setShowDeleted(e.target.checked)}
        />
        Show Deleted Products
      </label>

      <table>
        <thead>
          <tr>
            <th>Product ID</th>
            <th>Name</th>
            <th>Brand</th>
            <th>Price</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {products.map(product => (
            <tr key={product._id}>
              <td>{product.productId}</td>
              <td>{product.name}</td>
              <td>{product.brand}</td>
              <td>${product.pricing?.finalPrice}</td>
              <td>
                {product.isDeleted ? (
                  <div>
                    <span className="badge badge-danger">Deleted</span>
                    <small>
                      by {product.deletedBy?.name} on {' '}
                      {new Date(product.deletedAt).toLocaleDateString()}
                    </small>
                  </div>
                ) : (
                  <span className="badge badge-success">{product.status}</span>
                )}
              </td>
              <td>
                {product.isDeleted ? (
                  <button onClick={() => handleRestore(product.productId)}>
                    Restore
                  </button>
                ) : (
                  <>
                    <button onClick={() => navigate(`/admin/products/edit/${product.productId}`)}>
                      Edit
                    </button>
                    <button onClick={() => handleDelete(product.productId)}>
                      Delete
                    </button>
                  </>
                )}
              </td>
            </tr>
          ))}
        </tbody>
      </table>

      {/* Pagination */}
      <div className="pagination">
        <button
          disabled={pagination.current === 1}
          onClick={() => fetchProducts(pagination.current - 1)}
        >
          Previous
        </button>
        <span>Page {pagination.current} of {pagination.pages}</span>
        <button
          disabled={pagination.current === pagination.pages}
          onClick={() => fetchProducts(pagination.current + 1)}
        >
          Next
        </button>
      </div>
    </div>
  );
};
```

---

## Summary

### ‚úÖ Complete Feature List

1. **Soft Delete System**
   - Categories and Products are not permanently deleted
   - Deleted items hidden from public/customer APIs
   - Admin can view deleted items with `showDeleted=true`
   - Admin can restore deleted items

2. **Individual Image Management**
   - Delete specific images by 1-based index
   - Automatic S3 cleanup
   - Auto re-indexing of remaining images

3. **Image Reordering**
   - Drag-and-drop support
   - 1-based indexing
   - Custom order field

4. **Multiple Images for Categories**
   - New `images` array field
   - Old `image` field still works (backward compatibility)

5. **Auto-Generated IDs**
   - Product IDs: `PROD-YYYY-XXX`
   - Variant IDs: `VAR-YYYY-XXX`
   - Category IDs: `CAT-YYYY-XXX`
   - **Frontend MUST NOT send IDs**

---

### üî¥ Critical Reminders for Frontend Team

1. **NEVER send IDs when creating**
   - ‚ùå `productId`
   - ‚ùå `variantId`
   - ‚ùå `categoryId`
   - ‚úÖ Backend auto-generates all IDs

2. **Image indexing is 1-based**
   - First image = index 1
   - Second image = index 2
   - NOT zero-based!

3. **Use admin endpoints for deleted items**
   - Public APIs hide deleted items automatically
   - Admin APIs require `showDeleted=true` to see deleted items

4. **All admin operations require authentication**
   - Include `Authorization: Bearer <token>` header
   - Non-admin users get 403 Forbidden

---

### üìû Support

For technical questions or issues:
- Backend Team: backend@yourcompany.com
- API Documentation: [ADMIN_PANEL_COMPLETE_API_DOCUMENTATION.md](ADMIN_PANEL_COMPLETE_API_DOCUMENTATION.md)

---

**Document Version:** 1.0.0
**Last Updated:** January 15, 2025
**Status:** ‚úÖ Production Ready
